---
layout:     post
title:      总结一下公司单点登录
subtitle:   
date:       2016-09-26
author:     Lulongji
header-img: img/post-bg-2015.jpg
catalog: true
tags:
    - java
    - 单点
---

# 介绍

由于最近公司要做一个单点登录（Single Sign On 简称SSO）系统，所以就研究了一下。SSO 简单来说用户只需要登录一次 就可以访问所有相互信任的应用系统。
所以单点说白了也就两点因素：
- 存储信任
- 验证信任
只要保证了这两点就算是单点了。

###  实现方式

单点登录主要有三种实现方式，以下简述一下三种方式

###### 以Cookie作为凭证媒介

![1]()
这种是最简单的方式，用cookie来作为媒介，存放用户凭证。但是这种方式有两个隐患。
- cookies不安全
- 不能实现跨域免登陆 

###### 通过JSONP实现

![2]()
JSONP可以解决跨域问题，这种方式虽然能解决跨域问题，但是安全性其实跟把信任存储到Cookie是差不多的。如果一旦加密算法泄露了，攻击者可以在本地建立一个实现了登录接口的假冒父应用，通过绑定Host来把子应用发起的请求指向本地的假冒父应用，并作出回应。因为攻击者完全可以按照加密算法来伪造响应请求，子应用接收到这个响应之后一样可以通过验证，并且登录特定用户。

###### 通过页面重定向的方式

![3]()
最后一种方式，是通过父应用和子应用来回重定向中进行通信，实现信息的安全传递。父应用提供一个GET方式的登录接口，用户通过子应用重定向连接的方式访问这个接口，如果用户还没有登录，则返回一个的登录页面，用户输入账号密码进行登录。如果用户已经登录了，则生成加密的Token，并且重定向到子应用提供的验证Token的接口，通过解密和校验之后，子应用登录当前用户。

# 使用

使用的框架是Shiro +CAS（Central Authentication Service）。

### 角色
1. User （多个）
2. Web 应用 （多个）
3. SSO 认证中心 （1个）

### 原理

盗一张图来解释下：
![4]()
1. 所有的认证登录都走SSO认证中心
2. SSO 认证中心通过一些方法来告诉Web 应用当前用户是不是已经认证过的用户。
3. SSO 认证中心和所有的Web应用建立一种信任关系，也就是说web应用必须信任认证中心。


### CAS 简介

1. 开源、多协议（CAS、Oauth、OpenID、 、 RESTful API 、 SAML1.1 、 SAML2.0 等）
2. 支持多种认证机制： Active Directory 、 JAAS 、 JDBC 、 LDAP 、 X.509 Certificates 等
3. 安全策略：使用票据（ Ticket ）来实现支持的认证协议
4. 支持授权：可以决定哪些服务可以请求和验证服务票据（ Service Ticket ）
5. 提供高可用性：通过把认证过的状态数据存储在 TicketRegistry 组件中，这些组件有很多支持分布式环境的实现，如： BerkleyDB 、 Default 、 EhcacheTicketRegistry 、 JDBCTicketRegistry 、 JBOSS TreeCache 、 JpaTicketRegistry 、 MemcacheTicketRegistry
6. 支持多种客户端： Java 、 .Net 、 PHP 、 Perl 、 Apache, uPortal 等

# SSO






参考文章：
	[http://www.jianshu.com/p/613e44d4a464]
	


